<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web AI — Built-in Chrome • Playground + Blog</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Small in-page styles for nicer code blocks (Tailwind + minimal extras) -->
  <style>
    pre.code {
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <div class="max-w-6xl mx-auto p-6">
    <!-- Header -->
    <header class="mb-6">
      <h1 class="text-3xl font-bold">Web AI — Chrome Built-in APIs</h1>
      <p class="text-gray-600 mt-1">Interactive playground on the left, explainer blog on the right. Click an example to run it and view the data-driven documentation.</p>
      <p class="text-sm text-yellow-700 mt-2 bg-yellow-50 inline-block px-3 py-2 rounded">
        Experimental APIs — prefer Chrome 138+ (Canary/Dev), enable relevant flags (see docs).
      </p>
    </header>

    <!-- Two-column layout: left = playground, right = documentation/blog -->
    <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- LEFT: Working examples -->
      <section class="space-y-6" id="playground-accordion">
        <!-- Accordion Card: Summarizer -->
        <article class="bg-white rounded shadow" id="card-summarizer">
          <button type="button" class="w-full flex items-center justify-between p-5 focus:outline-none accordion-header" aria-expanded="true" aria-controls="sumPanel">
            <div>
              <h2 class="text-xl font-semibold">Summariser</h2>
              <p class="text-sm text-gray-600">Paste long text and generate a concise summary (key-points).</p>
            </div>
            <span class="ml-4 text-gray-400 accordion-icon">&#9660;</span>
          </button>
          <div id="sumPanel" class="accordion-panel px-5 pb-5 block">
            <!-- UI -->
            <div class="flex gap-2 justify-end mb-2">
              <button class="text-sm px-2 py-1 border rounded text-gray-600" onclick="showDoc('summarizer')">Docs</button>
            </div>
            <textarea id="sumLeftInput" rows="5" class="w-full border rounded p-2" placeholder="Paste article or notes..."></textarea>
            <div class="flex gap-2 mt-3">
              <button id="sumRun" class="bg-blue-600 text-white px-4 py-2 rounded">Run</button>
              <button id="sumClearLeft" class="px-4 py-2 border rounded">Clear</button>
              <span id="sumStatus" class="ml-auto text-sm text-gray-500 self-center"></span>
            </div>
            <h4 class="mt-3 font-medium">Output</h4>
            <pre id="sumLeftOutput" class="mt-2 p-3 bg-gray-50 border rounded min-h-[80px] code"></pre>
          </div>
        </article>

        <!-- Accordion Card: Prompt API -->
        <article class="bg-white rounded shadow" id="card-prompt">
          <button type="button" class="w-full flex items-center justify-between p-5 focus:outline-none accordion-header" aria-expanded="false" aria-controls="promptPanel">
            <div>
              <h2 class="text-xl font-semibold">Prompt (Text generation)</h2>
              <p class="text-sm text-gray-600">Ask the on-device language model a question — streaming response shown live.</p>
            </div>
            <span class="ml-4 text-gray-400 accordion-icon">&#9660;</span>
          </button>
          <div id="promptPanel" class="accordion-panel px-5 pb-5 hidden">
            <div class="flex gap-2 justify-end mb-2">
              <button class="text-sm px-2 py-1 border rounded text-gray-600" onclick="showDoc('prompt')">Docs</button>
            </div>
            <input id="promptLeftInput" class="w-full border rounded p-2" placeholder="Explain recursion in simple terms..." />
            <div class="flex gap-2 mt-3">
              <button id="promptRun" class="bg-green-600 text-white px-4 py-2 rounded">Run</button>
              <button id="promptStopBtn" class="px-4 py-2 border rounded">Stop</button>
              <button id="promptClearLeft" class="px-4 py-2 border rounded">Clear</button>
              <span id="promptStatus" class="ml-auto text-sm text-gray-500 self-center"></span>
            </div>
            <h4 class="mt-3 font-medium">Response (stream)</h4>
            <pre id="promptLeftOutput" class="mt-2 p-3 bg-gray-50 border rounded min-h-[120px] code"></pre>
          </div>
        </article>

        <!-- Accordion Card: Translation -->
        <article class="bg-white rounded shadow" id="card-translation">
          <button type="button" class="w-full flex items-center justify-between p-5 focus:outline-none accordion-header" aria-expanded="false" aria-controls="transPanel">
            <div>
              <h2 class="text-xl font-semibold">Translation</h2>
              <p class="text-sm text-gray-600">Translate between languages (ISO codes like <code>en</code>, <code>fr</code>, etc.).</p>
            </div>
            <span class="ml-4 text-gray-400 accordion-icon">&#9660;</span>
          </button>
          <div id="transPanel" class="accordion-panel px-5 pb-5 hidden">
            <div class="flex gap-2 justify-end mb-2">
              <button class="text-sm px-2 py-1 border rounded text-gray-600" onclick="showDoc('translation')">Docs</button>
            </div>
            <textarea id="transLeftInput" rows="3" class="w-full border rounded p-2" placeholder="Enter text to translate..."></textarea>
            <div class="flex gap-2 mt-2">
              <input id="transLeftFrom" class="w-1/2 border rounded p-2" placeholder="From (e.g., en)" />
              <input id="transLeftTo" class="w-1/2 border rounded p-2" placeholder="To (e.g., fr)" />
            </div>
            <div class="flex gap-2 mt-3">
              <button id="transRun" class="bg-purple-600 text-white px-4 py-2 rounded">Translate</button>
              <button id="transSwap" class="px-4 py-2 border rounded">Swap</button>
              <button id="transClearLeft" class="px-4 py-2 border rounded">Clear</button>
              <span id="transStatus" class="ml-auto text-sm text-gray-500 self-center"></span>
            </div>
            <h4 class="mt-3 font-medium">Translated text</h4>
            <pre id="transLeftOutput" class="mt-2 p-3 bg-gray-50 border rounded min-h-[80px] code"></pre>
          </div>
        </article>
      </section>

      <script>
        // Accordion logic
        document.querySelectorAll('#playground-accordion .accordion-header').forEach((btn, idx, arr) => {
          btn.addEventListener('click', function () {
            const expanded = this.getAttribute('aria-expanded') === 'true';
            // Collapse all panels
            arr.forEach(b => {
              b.setAttribute('aria-expanded', 'false');
              b.querySelector('.accordion-icon').style.transform = '';
              const panelId = b.getAttribute('aria-controls');
              document.getElementById(panelId).classList.add('hidden');
              document.getElementById(panelId).classList.remove('block');
            });
            // Expand this panel if it was not already open
            if (!expanded) {
              this.setAttribute('aria-expanded', 'true');
              this.querySelector('.accordion-icon').style.transform = 'rotate(180deg)';
              const panelId = this.getAttribute('aria-controls');
              document.getElementById(panelId).classList.remove('hidden');
              document.getElementById(panelId).classList.add('block');
            }
          });
        });
      </script>

      <!-- RIGHT: Data-driven blog/documentation -->
      <aside class="space-y-4">
        <!-- Blog header -->
        <div class="bg-white rounded shadow p-5">
          <h3 class="text-xl font-semibold" id="docTitle">Explore API Docs</h3>
          <p class="text-sm text-gray-600" id="docIntro">Click an example on the left to view the corresponding documentation, examples, and code snippets. Documentation is stored as JSON and rendered here.</p>
        </div>

        <!-- Rendered documentation pane -->
        <div id="docPane" class="bg-white rounded shadow p-5 overflow-auto" style="max-height:65vh;">
          <!-- By default show a friendly intro blog-style -->
          <article id="docContent">
            <h4 class="text-lg font-semibold">Welcome to the Web AI blog</h4>
            <p class="text-gray-700 mt-2">This playground demonstrates three built-in Chrome AI APIs.</p>
            <p class="text-sm text-gray-600 mt-2">Example docs include: overview, flags/requirements, parameters, sample code, and suggested use-cases.</p>
          </article>
        </div>

         <!-- Small tips area -->
        <div class="bg-white p-4 rounded shadow text-sm text-gray-700">
          <strong>Tips:</strong>
          <ul class="list-disc list-inside mt-2">
            <li>Click any example's <em>Docs</em> button or Run to load the right-column article for that API.</li>
            <li>If APIs aren't available, try Chrome Canary/Dev and enable experimental flags in <code>chrome://flags</code>.</li>
          </ul>
        </div>
      </aside>
    </main>

    <!-- Footer -->
    <footer class="mt-6 text-center text-sm text-gray-600">
      Built as an educational demo — APIs may differ across Chrome builds. Check <code>window.ai</code> in DevTools for exact names.
    </footer>
  </div>

  <!-- =====================
       Data-driven documentation JSON
       ===================== -->
  <script>
    // This JSON object contains the documentation/blog entries for each API.
    // It's the single source of truth that the right column renders from.
    const API_DOCS = {
      "summarizer": {
          "title": "Summarizer API — On-device summarization",
          "summary": "Condenses long blocks of text into shorter summaries or key points using Chrome's on-device Gemini Nano model.",
          "flags": ["#summarizer-api", "#optimization-guide-on-device-model"],
          "requirements": "Chrome 138+ (Canary/Dev recommended). May download a model (~100s MB to GB depending on build).",
          "options": {
            "type": "tldr | key-points | teaser | headline",
            "format": "plain-text | markdown",
            "length": "short | medium | long"
          },
          "code_sample": `// Check if Summarizer API is available
if ('Summarizer' in window) {
  const summarizer = await Summarizer.create({
    type: 'key-points',
    format: 'plain-text',
    length: 'short',
  });
  const summary = await summarizer.summarize('Long text to summarize...');
  summarizer.destroy();
} else {
  console.log('Summarizer API not available');
}`,
          "how_it_works": [
            "Check feature availability (Summarizer or window.ai.summarizer).",
            "Call availability() — Chromium decides whether to download model.",
            "Create summarizer session and call summarize(text).",
            "Display result and destroy session when done."
          ],
          "use_cases": [
            "Summarizing long articles, meeting notes, or PRDs.",
            "Providing condensed previews in UIs.",
            "Mobile apps for offline summaries (privacy-preserving)."
          ],
          "doc_url": "https://developer.chrome.com/docs/ai/summarizer-api"
      },

      "prompt": {
          "title": "Prompt API — Interactive text generation",
          "summary": "Send natural language prompts to an on-device language model. Supports streaming for real-time typing effects and multimodal inputs in some builds.",
          "flags": ["#prompt-api-for-gemini-nano", "#optimization-guide-on-device-model"],
          "requirements": "Chrome 138+. Streaming may be supported via promptStreaming() on the session object.",
          "options": {
            "systemPrompt": "String (sets AI persona/behavior)",
            "expectedInputs": "Optional for multimodal (audio/image)",
            "streaming": "Yes — use promptStreaming()"
          },
          "code_sample": `// Check if LanguageModel API is available
if ('LanguageModel' in window) {
  const session = await LanguageModel.create({
    systemPrompt: 'You are a helpful assistant.'
  });
  const stream = session.promptStreaming('Explain recursion for beginners');
  for await (const chunk of stream) {
    console.log(chunk);
  }
  session.destroy();
} else {
  console.log('Prompt API not available');
}`,
          "how_it_works": [
            "Create a language model session with a system prompt.",
            "Call promptStreaming() (or prompt()) to get responses.",
            "Iterate chunks for streaming UI; destroy session on finish."
          ],
          "use_cases": [
            "In-app assistants, content generation, code explanation, chat features."
          ],
          "doc_url": "https://developer.chrome.com/docs/ai/prompt-api"
      },

      "translation": {
          "title": "Translation API — On-device translation",
          "summary": "Translate text between languages on-device for low-latency, privacy-friendly translations without server roundtrips.",
          "flags": ["#translation-api", "#optimization-guide-on-device-model"],
          "requirements": "Chrome 138+. Language support varies by build & model version.",
          "options": {
            "sourceLanguage": "ISO code like 'en'",
            "targetLanguage": "ISO code like 'fr'"
          },
          "code_sample": `// Check if Translator API is available
if ('Translator' in window) {
  const translator = await Translator.create({
    sourceLanguage: 'en',
    targetLanguage: 'fr',
  });
  const result = await translator.translate('Hello world');
  translator.destroy();
} else {
  console.log('Translator API not available');
}`,
          "how_it_works": [
            "Feature detect translator surface (Translator).",
            "Create an instance with source/target languages.",
            "Call translate(text) and display result; then destroy."
          ],
          "use_cases": [
            "Multilingual chat UIs, content localization, on-device apps with privacy."
          ],
          "doc_url": "https://developer.chrome.com/docs/ai/translator-api"
      }
    };

    // Toggle raw JSON viewer
    document.getElementById('toggleJsonBtn').addEventListener('click', () => {
      const el = document.getElementById('rawJson');
      if (el.classList.contains('hidden')) {
        el.textContent = JSON.stringify(API_DOCS, null, 2);
        el.classList.remove('hidden');
        document.getElementById('toggleJsonBtn').textContent = 'Hide JSON';
      } else {
        el.classList.add('hidden');
        document.getElementById('toggleJsonBtn').textContent = 'Show JSON';
      }
    });

    // Renders a blog-style article into the right column using the JSON doc
    function renderDoc(key) {
      const doc = API_DOCS[key];
      if (!doc) return;

      const container = document.getElementById('docContent');
      container.innerHTML = `
        <article>
          <h4 class="text-xl font-semibold">${escapeHtml(doc.title)}</h4>
          <p class="text-gray-700 mt-2">${escapeHtml(doc.summary)}</p>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h5 class="font-semibold">Flags & Requirements</h5>
              <p class="text-sm text-gray-600 mt-1">Flags: ${doc.flags.map(f => `<code class="px-1 bg-gray-100 rounded">${f}</code>`).join(' ')}</p>
              <p class="text-sm text-gray-600 mt-2">${escapeHtml(doc.requirements)}</p>
              ${doc.doc_url ? `<a href="${doc.doc_url}" target="_blank" rel="noopener" class="inline-block mt-2 text-blue-700 underline text-sm">Official documentation</a>` : ''}
            </div>
            <div>
              <h5 class="font-semibold">Options</h5>
              <pre class="mt-1 p-3 bg-gray-50 border rounded code">${escapeHtml(JSON.stringify(doc.options, null, 2))}</pre>
            </div>
          </div>

          <h5 class="mt-4 font-semibold">How it works</h5>
          <ol class="list-decimal list-inside mt-2 text-sm text-gray-700">
            ${doc.how_it_works.map(s => `<li>${escapeHtml(s)}</li>`).join('')}
          </ol>

          <h5 class="mt-4 font-semibold">Code sample</h5>
          <pre class="mt-2 p-3 bg-black text-green-200 rounded code">${escapeHtml(doc.code_sample)}</pre>

          <h5 class="mt-4 font-semibold">Suggested use cases</h5>
          <ul class="list-disc list-inside mt-2 text-sm text-gray-700">
            ${doc.use_cases.map(s => `<li>${escapeHtml(s)}</li>`).join('')}
          </ul>
        </article>
      `;
    }

    // Utility: escape HTML for safe rendering
    function escapeHtml(s) {
      return String(s)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;');
    }

    // Expose docs when user clicks left column cards or Docs button
    // Called via onclick handlers wired in HTML (showDoc('summarizer'))
    function showDoc(key) {
      renderDoc(key);
      // Also scroll right column into view on narrow screens
      document.getElementById('docPane').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Render default JSON into rawJson (hidden by default)
    document.getElementById('rawJson').textContent = JSON.stringify(API_DOCS, null, 2);
  </script>

  <!-- =====================
       Playground logic (left column)
       ===================== -->
  <script>
    /**************************************************************************
     * Playground handlers: reuse patterns from earlier examples.
     * Each handler attempts several feature names (Summarizer global or window.ai)
     * so the demo works across slightly different Chrome builds.
     **************************************************************************/

    // ---------- Summariser ----------
    document.getElementById('sumRun').addEventListener('click', async () => {
      // When user runs the example, show the doc too (data-driven behavior requested)
      showDoc('summarizer');

      const statusEl = document.getElementById('sumStatus');
      const outEl = document.getElementById('sumLeftOutput');
      const text = document.getElementById('sumLeftInput').value.trim();

      if (!text) {
        outEl.textContent = 'Paste some text to summarise.';
        return;
      }

      statusEl.textContent = 'Preparing…';
      outEl.textContent = '';

      const hasGlobal = typeof Summarizer !== 'undefined';
      const hasWrapper = window.ai && typeof window.ai.summarizer !== 'undefined';

      if (!hasGlobal && !hasWrapper) {
        outEl.textContent = 'Summariser not available in this browser. Try Chrome Canary/Dev and enable #summarizer-api.';
        statusEl.textContent = '';
        return;
      }

      try {
        const opts = { type: 'key-points', format: 'plain-text', length: 'short', sharedContext: 'Playground summarise' };
        let availability, s;

        if (hasGlobal) {
          availability = await Summarizer.availability(opts);
          if (availability === 'unavailable') throw new Error('Unavailable for options');
          s = await Summarizer.create(opts);
        } else {
          availability = await window.ai.summarizer.availability(opts);
          if (availability === 'unavailable') throw new Error('Unavailable for options');
          s = await window.ai.summarizer.create(opts);
        }

        statusEl.textContent = 'Running model…';
        // Some implementations return a string; others may stream — we assume a string result here.
        const res = await s.summarize(text);
        outEl.textContent = res;

        if (s && typeof s.destroy === 'function') s.destroy();
        statusEl.textContent = 'Done';
      } catch (err) {
        console.error(err);
        outEl.textContent = 'Error: ' + (err.message || String(err));
        statusEl.textContent = '';
      }
    });

    document.getElementById('sumClearLeft').addEventListener('click', () => {
      document.getElementById('sumLeftInput').value = '';
      document.getElementById('sumLeftOutput').textContent = '';
      document.getElementById('sumStatus').textContent = '';
    });

    // ---------- Prompt (streaming) ----------
    let promptSession = null;
    let promptAbort = null;
    const stopButton = document.getElementById('promptStopBtn');

    document.getElementById('promptRun').addEventListener('click', async () => {
      showDoc('prompt'); // show doc when running

      const outputEl = document.getElementById('promptLeftOutput');
      const statusEl = document.getElementById('promptStatus');
      outputEl.textContent = '';
      statusEl.textContent = 'Preparing…';

      const promptText = document.getElementById('promptLeftInput').value.trim();
      if (!promptText) {
        outputEl.textContent = 'Please type a prompt.';
        statusEl.textContent = '';
        return;
      }

      // Check for modern API surface
      if (typeof LanguageModel !== 'function') {
        outputEl.textContent = 'Prompt API not found. Try Chrome Dev/Canary with flags.';
        statusEl.textContent = '';
        return;
      }

      try {
        // Abort controller for cancellation
        const controller = new AbortController();
        stopButton.onclick = () => controller.abort();

        const promptSession = await LanguageModel.create({
          signal: controller.signal,
          initialPrompts: [
            {
              role: 'system',
              content:
                'You are a helpful assistant. Keep answers concise.',
            },
          ]
        });
        
        statusEl.textContent = 'Streaming…';

        // Start streaming — pass signal if accepted by implementation
        const streamIter = promptSession.promptStreaming(promptText);

        for await (const chunk of streamIter) {
          outputEl.textContent += chunk;
          outputEl.scrollTop = outputEl.scrollHeight;
        }

        statusEl.textContent = 'Done';
      } catch (err) {
        if (err?.name === 'AbortError') {
          outputEl.textContent += '\n\n[Cancelled by user]';
        } else {
          console.error('Prompt error', err);
          outputEl.textContent += '\n\n[Error] ' + (err.message || String(err));
        }
        statusEl.textContent = '';
      } finally {
        try { if (promptSession && typeof promptSession.destroy === 'function') promptSession.destroy(); } catch(e) {}
        promptSession = null;
        promptAbort = null;
      }
    });

    stopButton.addEventListener('click', () => {
      // Cancel streaming via AbortController and destroy session
      if (promptAbort) {
        try { promptAbort.abort(); } catch (e) {}
      }
      if (promptSession && typeof promptSession.destroy === 'function') {
        try { promptSession.destroy(); } catch(e) {}
        promptSession = null;
      }
      document.getElementById('promptStatus').textContent = '';
    });

    document.getElementById('promptClearLeft').addEventListener('click', () => {
      document.getElementById('promptLeftInput').value = '';
      document.getElementById('promptLeftOutput').textContent = '';
      document.getElementById('promptStatus').textContent = '';
    });

    // ---------- Translation ----------
    document.getElementById('transRun').addEventListener('click', async () => {
      showDoc('translation'); // show doc when running

      const outEl = document.getElementById('transLeftOutput');
      const statusEl = document.getElementById('transStatus');
      outEl.textContent = '';
      statusEl.textContent = 'Preparing…';

      const text = document.getElementById('transLeftInput').value.trim();
      const from = (document.getElementById('transLeftFrom').value || 'en').trim();
      const to = (document.getElementById('transLeftTo').value || 'fr').trim();

      if (!text) {
        outEl.textContent = 'Please enter text to translate.';
        statusEg = '';
        return;
      }
      // Feature detect likely translator surfaces
      const translatorAPI = window.ai && (window.ai.translator || window.ai.translation) ? (window.ai.translator || window.ai.translation) : null;
      if (!('Translator' in self)) {
        outEl.textContent = 'Translation API not available. Try Chrome Dev/Canary with flags.';
        statusEl.textContent = '';
        return;
      }

      try {
        let translatorInstance;
        // Some builds require create({sourceLanguage, targetLanguage})
        if (typeof Translator.create === 'function') {
          translatorInstance = await Translator.create({ sourceLanguage: from, targetLanguage: to });
        } else {
          translatorInstance = translatorAPI;
        }

        statusEl.textContent = 'Translating…';

        let translated;
        if (typeof translatorInstance.translate === 'function') {
          translated = await translatorInstance.translate(text);
        } else if (typeof translatorAPI.translate === 'function') {
          translated = await translatorAPI.translate(text, { from, to });
        } else {
          throw new Error('No translate() method found on translator API');
        }

        outEl.textContent = translated;
        statusEl.textContent = 'Done';

        // Cleanup
        if (translatorInstance && typeof translatorInstance.destroy === 'function') {
          translatorInstance.destroy();
        }
      } catch (err) {
        console.error('Translation error', err);
        outEl.textContent = 'Error: ' + (err.message || String(err));
        statusEl.textContent = '';
      }
    });

    document.getElementById('transSwap').addEventListener('click', () => {
      const a = document.getElementById('transLeftFrom');
      const b = document.getElementById('transLeftTo');
      const tmp = a.value;
      a.value = b.value;
      b.value = tmp;
    });

    document.getElementById('transClearLeft').addEventListener('click', () => {
      document.getElementById('transLeftInput').value = '';
      document.getElementById('transLeftOutput').textContent = '';
      document.getElementById('transStatus').textContent = '';
    });
  </script>
</body>
</html>
